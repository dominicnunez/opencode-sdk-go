# opencode-sdk-go

[![Go Reference](https://pkg.go.dev/badge/github.com/dominicnunez/opencode-sdk-go.svg)](https://pkg.go.dev/github.com/dominicnunez/opencode-sdk-go)

An idiomatic Go SDK for the [OpenCode](https://opencode.ai) REST API. Built with Go's standard library — no generated code, no heavy dependencies.


## Installation

```sh
go get github.com/dominicnunez/opencode-sdk-go
```

```go
import opencode "github.com/dominicnunez/opencode-sdk-go"
```

## Requirements

Go 1.25+

## Usage

Full API surface documented in [api.md](api.md).

```go
package main

import (
	"context"
	"fmt"
	"log"
	"time"

	opencode "github.com/dominicnunez/opencode-sdk-go"
)

func main() {
	client, err := opencode.NewClient(
		opencode.WithBaseURL("http://localhost:8080"),
		opencode.WithTimeout(30 * time.Second),
	)
	if err != nil {
		log.Fatal(err)
	}

	// List all sessions
	sessions, err := client.Session.List(context.TODO(), opencode.SessionListParams{})
	if err != nil {
		log.Fatal(err)
	}
	fmt.Printf("Found %d sessions\n", len(sessions))

	// Create a new session
	session, err := client.Session.New(context.TODO(), opencode.SessionNewParams{
		Agent: "general-purpose",
		Contents: []opencode.MessageUnionParam{
			opencode.UserMessageParam{
				Role: opencode.MessageRoleUser,
				Parts: []opencode.PartInputParam{
					opencode.TextPartInputParam{
						Text: "Hello, how can you help me?",
					},
				},
			},
		},
	})
	if err != nil {
		log.Fatal(err)
	}
	fmt.Printf("Created session: %s\n", session.ID)
}
```

## Key Features

### Request Parameters

Idiomatic Go types — required fields are direct types, optional fields use pointers:

```go
params := opencode.SessionCommandParams{
	Command:   "list-files",              // required: direct type
	Directory: opencode.Ptr("./src"),     // optional: pointer
	Agent:     nil,                       // optional: nil = omit
}
```

### Client Configuration

Functional options pattern:

```go
client, err := opencode.NewClient(
	opencode.WithBaseURL("https://api.opencode.ai"),
	opencode.WithTimeout(60 * time.Second),
	opencode.WithMaxRetries(5),
	opencode.WithHTTPClient(myHTTPClient),
)
```

### Union Types

Discriminated unions with `As*()` methods:

```go
for _, msg := range messages {
	if user, ok := msg.AsUser(); ok {
		fmt.Printf("User: %s\n", user.Parts[0].AsText().Text)
	} else if assistant, ok := msg.AsAssistant(); ok {
		fmt.Printf("Assistant: %s\n", assistant.Parts[0].AsText().Text)
	}
}
```

### Streaming Events (SSE)

```go
stream, err := client.Event.ListStreaming(context.TODO(), opencode.EventListStreamingParams{})
if err != nil {
	log.Fatal(err)
}
defer stream.Close()

for stream.Next() {
	event := stream.Current()
	if msgUpdated, ok := event.AsMessageUpdated(); ok {
		fmt.Printf("Message updated: %s\n", msgUpdated.Data.Info.ID)
	}
}
if err := stream.Err(); err != nil {
	log.Fatal(err)
}
```

### Error Handling

Typed errors with `errors.As`:

```go
_, err := client.Session.List(context.TODO(), opencode.SessionListParams{})
if err != nil {
	var apierr *opencode.Error
	if errors.As(err, &apierr) {
		println(string(apierr.DumpRequest(true)))
		println(string(apierr.DumpResponse(true)))
	}
	panic(err)
}
```

### Automatic Retries

Exponential backoff (default: 2 retries) for connection errors, 408, 429, and 5xx responses. Backoff schedule: 500ms → 1s → 2s → 4s → 8s (capped).

## Origin & Compatibility

This SDK was originally generated by [Stainless](https://stainless.com) for the upstream [`anomalyco/opencode-sdk-go`](https://github.com/anomalyco/opencode-sdk-go). It has been fully rewritten as an idiomatic Go SDK using only the standard library — all 51 endpoints, with proper Go conventions (functional options, typed errors, pointer optionals, discriminated unions).

The SDK is built against the upstream [OpenAPI spec](specs/openapi.yml) from Stainless, so it maintains full API compatibility with the generated SDK's endpoint coverage. If the upstream spec updates, this SDK can be diffed and updated accordingly while keeping its idiomatic Go design.

## Versioning

This package follows [SemVer](https://semver.org/spec/v2.0.0.html). Minor versions may include changes to internals not intended for external use.

## Contributing

See [CONTRIBUTING.md](./CONTRIBUTING.md).

